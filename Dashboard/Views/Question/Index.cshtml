@model IPagedList<QuestionsSYS.ModelViews.QuestionsListView>
@using PagedList
@using PagedList.Mvc

@{
    ViewBag.Title = "Tüm Sorular";
}

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Sorular</h2>
        <ol class="breadcrumb">
            <li>
                <a href="@Url.Action("Index", "Dashboards")">Yönetim</a>
            </li>
            <li class="active">
                <strong><a>Tüm Sorular</a></strong>
            </li>
        </ol>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="ibox-content">
            <div class="sk-spinner sk-spinner-double-bounce">
                <div class="sk-double-bounce1"></div>
                <div class="sk-double-bounce2"></div>
            </div>
            <div id="question-list" class="table-responsive"></div>
            <div class="m-t-md">
                <small class="pull-right">
                    Son Liste Tarihi: @Html.Label(DateTime.Now.ToLongDateString())
                </small>
            </div>
        </div>
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="ibox-content task-container">
            <div class="sk-spinner sk-spinner-double-bounce">
                <div class="sk-double-bounce1"></div>
                <div class="sk-double-bounce2"></div>
            </div>
            <h2>Görev</h2>
            <p>
                <small>Seçtiğiniz soruları personele görevlendirmek aşağıda formu doldurun.</small>
            </p>            
            <div class="form-inline">
                <div class="form-group">
                    <label for="role" class="sr-only">Rol</label>
                    <select name="source" id="source" class="personnel-list form-control">
                        <option></option>
                        @foreach (var item in ViewBag.personnel)
                        {
                            <option value="@item.Id">@item.Name @item.Surname </option>
                        }
                    </select>
                    <button id="add_task" class="btn  btn-sm btn-primary no-margins">Görev Ekle</button>
                </div>
             </div>
            
            
        </div>
    </div>
</div>

    @section Styles{
        @Styles.Render("~/plugins/toastrStyles")
        @Styles.Render("~/plugins/awesomeCheckboxStyles")
        @Styles.Render("~/plugins/select2Styles")
    }
    @section Scripts{
        @Scripts.Render("~/plugins/toastr")
        @Scripts.Render("~/plugins/select2")
        @Scripts.Render("~/Scripts/jquery.unobtrusive-ajax.min.js");
        <script type="text/javascript">

            $(document).ready(function () {
                $.ajax({
                    type: "GET",
                    url: "All",
                    beforeSend: function () {
                        $(".task-container").toggleClass('sk-loading');
                    },
                    success: function (responseData) {
                        $(".task-container").toggleClass('sk-loading');
                        $('#question-list').html(responseData);
                    }
                })

                $(".personnel-list").select2({
                    placeholder: "Personel seçin",
                    allowClear: true
                });

                $("#add_task").on("click", function () {
                    var data = { user_id: $(".personnel-list").val(), questions: [] };
                    var selectedQuestions = Array.from($(".checkbox-success input:checked"));
                    selectedQuestions.forEach(sq => data.questions.push($(sq).attr("data-item")));

                    $.ajax({
                        type: "POST",
                        url: "/Task/Add",
                        data: data,
                        beforeSend: function () {
                            $(".task-container").toggleClass('sk-loading');
                        },
                        success: function (responseData) {
                            toastr.success("Görev atandı.", "Tamam");
                            $(".task-container").toggleClass('sk-loading');
                        },
                        error: function () {
                            toastr.error("Personel seçmediniz veya bir hata oluştu. Sayfayı yenileyip tekrar deneyin.", "Hata");
                            $(".task-container").toggleClass('sk-loading');
                        }
                    })
                })

            });

            function DeleteSuccess(e) {
                $(e).parents("tr").remove();
                $(".pagination-container").first().remove();
                toastr.success("Kayıt silindi.", "Tamam");
            }
            function DeleteFailed() {
                toastr.error("Kayıt silinmedi. tekrar deneyin.", "Hata")
            }

            function Begin() {
                $('.ibox-content').toggleClass('sk-loading');
            }

            function OnComplate() {
                $('.ibox-content').toggleClass('sk-loading');
                $('.ibox-content').removeClass('sk-loading');
            }

            if (location.search.indexOf("success=failed_remove") > -1) {
                toastr.error("Kayıt silinmedi. tekrar deneyin.", "Hata")
            }
            if (location.search.indexOf("success=delete_ok") > -1) {
                toastr.success("Kayıt silindi.", "Tamam")
            }
        </script>
    }
